server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: debug
positions:
  filename: /tmp/positions.yaml
clients:
  - url: http://192.168.29.252:3100/loki/api/v1/push
    external_labels:
      host: logs
      environment: production
      app_name: test_app_logs
    backoff_config:
      min_period: 100ms
      max_period: 10s
      max_retries: 10
scrape_configs:
  - job_name: app_logs
    static_configs:
    - targets:
        - localhost
      labels:
        job: test_app_logs
        __path__: /media/rails_portal/log/*.log
    pipeline_stages:
    - match:
        selector: '{job="test_app_logs"}'
        stages:
        - regex:
            expression: '^(?P<level>[A-Z]+)\[(?P<process_id>\d+)\] - (?P<timestamp>\d{1,2}\/\d{1,2}\/\d{2}\s+\d{1,2}:\d{2}[ap]m): (?P<content>.*)'
        - timestamp:
            source: timestamp
            format: '1/2/06  3:04pm'
        - labels:
            level:
            process_id:
            timestamp:
        - output:
            source: content
  - job_name: app_logs
    static_configs:
    - targets:
        - localhost
      labels:
        job: test_app_logs 
        __path__: /media/rails_portal/log/*.log.*
    pipeline_stages:
    - match:
        selector: '{job="test_app_logs"}'
        stages:
        - regex:
            expression: '^(?P<level>[A-Z]+)\[(?P<process_id>\d+)\] - (?P<timestamp>\d{1,2}\/\d{1,2}\/\d{2}\s+\d{1,2}:\d{2}[ap]m): (?P<content>.*)'
        - timestamp:
            source: timestamp
            format: '1/2/06  3:04pm'
        - labels:
            level:
            process_id:
            timestamp:
        - output:
            source: content
